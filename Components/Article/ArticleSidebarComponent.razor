@inherits FluxorComponent
@inject IState<ArticleState> ArticleState
@inject IState<CourseState> CourseState
@inject IState<DevModeState> DevModeState
@inject IDispatcher Dispatcher

<RightSideBarComponent>
    @if (!ArticleState.Value.IsLoading)
    {
        <div class="article-nav">
            <ArticleSidebarButtonComponent IsActive="CurrentTab == ArticleSidebarTab.CourseStructure"
                                           OnTabChanged="() => ChangeTab(ArticleSidebarTab.CourseStructure)">
                <i class="fa fa-folder"></i><span>Structure</span>
            </ArticleSidebarButtonComponent>
            <ArticleSidebarButtonComponent IsActive="CurrentTab == ArticleSidebarTab.HistoryBranch"
                                           OnTabChanged="() => ChangeTab(ArticleSidebarTab.HistoryBranch)">
                <i class="fa fa-code-fork"></i><span>History</span>
            </ArticleSidebarButtonComponent>
        </div>
        if (CurrentTab == ArticleSidebarTab.HistoryBranch && ArticleState.Value.CurrentArticle != null)
        {
            <div class="article-nav" style="border-bottom: 1px solid silver">
                <ArticleSidebarHistoryTabComponent CurrentTab="HistoryTab"
                                                   OnTabChanged="() => ChangeHistoryTab(HistoryTab == ArticleSidebarHistoryTab.Article ?
                                                                 ArticleSidebarHistoryTab.Course : ArticleSidebarHistoryTab.Article)">
                </ArticleSidebarHistoryTabComponent>
            </div>
        }
<div class="article-sidebar-body">
    @switch (CurrentTab)
    {
        case ArticleSidebarTab.CourseStructure:
            <TreeViewComponent Records="CourseState.Value.CurrentCourse.Records"
                               ActiveRecords="CourseState.Value.ActiveRecords" FontSize="17px" />
            break;
        case ArticleSidebarTab.HistoryBranch:
            switch (HistoryTab)
            {
                case ArticleSidebarHistoryTab.Article:
                    <HistoryBranchComponent Commits="ArticleState.Value.CurrentArticle?.Commits?.Reverse<ArticleCommitViewModel>().ToList()"
                                            ActiveCommit="ArticleState.Value.CurrentCommit" />
                    break;
                case ArticleSidebarHistoryTab.Course:
                   <h1>Тёмыч Петух</h1>
                    break;
            }
            break;
    }
</div>
    }
</RightSideBarComponent>

<style>
    .article-nav {
            padding: 0;
            margin: 0;
            display: flex;
            width: 100%;
            height: 40px;
            }

    .article-sidebar-body {
            height: calc(100vh - 90px);
                overflow-y: auto;
            }
</style>

@code{
    private ArticleSidebarTab CurrentTab = ArticleSidebarTab.CourseStructure;
    private ArticleSidebarHistoryTab HistoryTab = ArticleSidebarHistoryTab.Article;

    private void ChangeTab(ArticleSidebarTab tab)
    {
        CurrentTab = tab;
    }

    private void ChangeHistoryTab(ArticleSidebarHistoryTab tab)
    {
        HistoryTab = tab;
    }
}